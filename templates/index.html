
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>四川棋牌网页版打包</title>

     <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">

    <!-- 可选的Bootstrap主题文件（一般不用引入） -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap-theme.min.css">

    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  </head>

  <body>
        <div class="container" style = " text-align: center;padding-top: 50px;">
           <button type="button" class="btn btn-primary btn-lg" id = "myButton"  onClick = "webBuild()" >打   包</button>
      </div>
       <div class="container" style = " text-align: center;padding-top: 50px;display:none" id = "downloadDiv">
        <a href = "/download/test.txt" id = "downloadLink">
           <button type="submit" class="btn btn-primary btn-lg" id = "downloadButton">下  载 </button>
        <a>
      </div>
       <div class="container" style = " text-align: center;padding-top: 50px; display:none" id = "apkname">sssss</div>
  </body>

<script type="text/javascript">
function webBuild()
{
  $('#myButton').attr("disabled","disabled");
  $('#myButton').text("正在打包...");

  $('#downloadDiv').hide();
  $('#apkname').hide();
  console.log("ddddd");
  url = "/webBuild/";
  postdata(url)
}

function postdata(url)
{
    $.ajax({
            type:"POST",
            url:url,
            dataType:"json",
            success:function(data)
            {
              console.log(data);
             /* $("#table").append('<tr><td>' + data.length + '</td></tr>')*/
             /*if(data["ret"] == 0)
                showError(data);
             else
               show(data);*/
             switch(parseInt(data["ret"]))
              {
                case -1: showConflict(data);break; //有人正在打包的情况
                case 0:  showError(data); break;
                case 1:  showSuccess(data);   break;
               }
            }
            });
 }

function showConflict(data)
{
   $('#myButton').removeAttr("disabled");
   $('#myButton').text("打包");
   $('#apkname').show();
   $('#apkname').text("有人正在打包，请稍后刷新重试！");
}

 function showSuccess(data)
 {
   $('#myButton').removeAttr("disabled");
    $('#myButton').text("打包")
   $('#downloadDiv').show();
   $('#apkname').show();
   $('#apkname').text(data["apkname"]);
   $('#downloadLink').attr("href","/download/"+data["apkname"]);
 }

 function showError(data)
 {
   $('#myButton').removeAttr("disabled");
   $('#myButton').text("打包");
   $('#apkname').show();
   $('#apkname').text("打包失败");
 }
  </script>
</html>
